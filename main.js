let fields = []
fields.push(new Field({ text: 'You are inside a brimstone mine', imagePath: '11.gif', color: 'rgb(235,211,64)', directions: ['E'], positionX: 1, positionY: 1 }))
fields.push(new Field({ text: 'You are at the entrance to the mine', imagePath: '12.gif', color: 'rgb(89,93,87)', directions: ['E', 'W'], positionX: 2, positionY: 1 }))
fields.push(new Field({ text: 'A hill', imagePath: '13.gif.gif', color: 'rgb(117,237,243)', directions: ['E', 'S', 'W'], positionX: 3, positionY: 1 }))
fields.push(new Field({ text: 'Some bushes', imagePath: '14.gif', color: 'rgb(202,230,51)', directions: ['E', 'W'], positionX: 4, positionY: 1 }))
fields.push(new Field({ text: 'An old deserted hut', imagePath: '15.gif', color: 'rgb(220,204,61)', directions: ['E', 'W'], positionX: 5, positionY: 1 }))
fields.push(new Field({ text: 'The edge of a forest', imagePath: '16.gif', color: 'rgb(167,245,63)', directions: ['E', 'W'], positionX: 6, positionY: 1 }))
fields.push(new Field({ text: 'A dark forest', imagePath: '17.gif', color: 'rgb(140,253,99)', directions: ['S', 'W'], positionX: 7, positionY: 1 }))

fields.push(new Field({ text: 'A man nearby making tar', imagePath: '21.gif', color: 'rgb(255,190,99)', directions: ['E'], positionX: 1, positionY: 2 }))
fields.push(new Field({ text: 'A timber yard', imagePath: '22.gif', color: 'rgb(255,190,99)', directions: ['E', 'W'], positionX: 2, positionY: 2 }))
fields.push(new Field({ text: 'You are by a roadside shrine', imagePath: '23.gif', color: 'rgb(167,245,63)', directions: ['E', 'N', 'W', 'S'], positionX: 3, positionY: 2 }))
fields.push(new Field({ text: 'You are by a small chapel', imagePath: '24.gif', color: 'rgb(212,229,36)', directions: ['E', 'W'], positionX: 4, positionY: 2 }))
fields.push(new Field({ text: 'You are on a road leading to a wood', imagePath: '25.gif', color: 'rgb(167,245,63)', directions: ['E', 'W'], positionX: 5, positionY: 2 }))
fields.push(new Field({ text: 'You are in a forest', imagePath: '26 i 65.gif', color: 'rgb(167,245,63)', directions: ['E', 'W'], positionX: 6, positionY: 2 }))
fields.push(new Field({ text: 'You are in a deep forest', imagePath: '27 i 67.gif', color: 'rgb(140,253,99)', directions: ['N', 'W'], positionX: 7, positionY: 2 }))

fields.push(new Field({ text: 'You are by the Vistula River', imagePath: '31.gif', color: 'rgb(122,232,252)', directions: ['N', 'E'], positionX: 1, positionY: 3 }))
fields.push(new Field({ text: 'You are by the Vistula River', imagePath: '32.gif', color: 'rgb(140,214,255)', directions: ['E', 'N'], positionX: 2, positionY: 3 }))
fields.push(new Field({ text: 'You are on a bridge over river', imagePath: '33.gif.gif', color: 'rgb(108,181,242)', directions: ['N'], positionX: 3, positionY: 3 }))
fields.push(new Field({ text: 'You are by the old tavern', imagePath: '34.gif', color: 'rgb(255,189,117)', directions: ['E'], positionX: 4, positionY: 3 }))
fields.push(new Field({ text: "You are at the town's end", imagePath: '35.gif', color: 'rgb(255,190,99)', directions: ['W', 'S', 'N'], positionX: 5, positionY: 3 }))
fields.push(new Field({ text: "You are in a butcher's shop", imagePath: '36.gif', color: 'rgb(255,188,102)', directions: ['S'], positionX: 6, positionY: 3 }))
fields.push(new Field({ text: "You are in a cooper's house", imagePath: '37.gif', color: 'rgb(255,188,102)', directions: ['S'], positionX: 7, positionY: 3 }))

fields.push(new Field({ text: 'You are in the Wawel Castle', imagePath: '41.gif', color: 'rgb(255,190,99)', directions: ['E'], positionX: 1, positionY: 4 }))
fields.push(new Field({ text: "You are inside a dragon's cave", imagePath: '42.gif', color: 'rgb(255,190,99)', directions: ['E'], positionX: 2, positionY: 4 }))
fields.push(new Field({ text: 'A perfect place to set a trap', imagePath: '43.gif', color: 'rgb(167,245,63)', directions: ['N'], positionX: 3, positionY: 4 }))
fields.push(new Field({ text: 'You are by the water mill', imagePath: '44.gif', color: 'rgb(212,229,36)', directions: ['E'], positionX: 4, positionY: 4 }))
fields.push(new Field({ text: 'You are at a main crossroad', imagePath: '45.gif', color: 'rgb(167,245,63)', directions: ['E', 'W', 'S', 'N'], positionX: 5, positionY: 4 }))
fields.push(new Field({ text: 'You are on a town street', imagePath: '46.gif', color: 'rgb(167,245,63)', directions: ['E', 'W', 'N'], positionX: 6, positionY: 4 }))
fields.push(new Field({ text: 'You are in a frontyard of your house', imagePath: '47.gif', color: 'rgb(140,253,99)', directions: ['W', 'S', 'N'], positionX: 7, positionY: 4 }))

fields.push(new Field({ text: 'You are by a swift stream', imagePath: '54.gif', color: 'rgb(108,181,242)', directions: ['E'], positionX: 4, positionY: 5 }))
fields.push(new Field({ text: "You are on a street leading forest", imagePath: '55.gif', color: 'rgb(255,190,99)', directions: ['W', 'S', 'N'], positionX: 5, positionY: 5 }))
fields.push(new Field({ text: "You are in a woodcutter's backyard", imagePath: '26 i .gif', color: 'rgb(255,190,99)', directions: ['S'], positionX: 6, positionY: 5 }))
fields.push(new Field({ text: "You are in a shoemaker's house", imagePath: '57.gif', color: 'rgb(254,194,97)', directions: ['N'], positionX: 7, positionY: 5 }))

fields.push(new Field({ text: 'You are in a bleak funeral house', imagePath: '64.gif', color: 'rgb(254,194,97)', directions: ['E'], positionX: 4, positionY: 6 }))
fields.push(new Field({ text: "You are on a path leading to the wood", imagePath: '26 i 65.gif', color: 'rgb(167,245,63)', directions: ['E', 'W', 'N'], positionX: 5, positionY: 6 }))
fields.push(new Field({ text: 'You are at the edge of a forest', imagePath: '66.gif', color: 'rgb(167,245,63)', directions: ['E', 'W', 'N'], positionX: 6, positionY: 6 }))
fields.push(new Field({ text: 'You are in a deep forest', imagePath: '27 i 67.gif', color: 'rgb(140,253,99)', directions: ['W'], positionX: 7, positionY: 6 }))


class Game {
    constructor() {
        this.fields = fields
        this.player = null
    }

    startGame() {
        this.player = new Player({ item: null, positionX: 7, positionY: 4 })
        return {
            isSuccess: true,
            current: this.getField({
                positionX: this.player.positionX,
                positionY: this.player.positionY
            })
        }
    }

    move({ where }) {
        for (let i = 0; i < this.fields.length; i++) {
            if (this.fields[i].positionX == this.player.positionX && this.fields[i].positionY == this.player.positionY) {
                for (let k = 0; k < this.fields[i].directions.length; k++) {
                    if (where == this.fields[i].directions[k]) {
                        this.player.move(where)
                        return {
                            isSuccess: true,
                            current: this.getField({
                                positionX: this.player.positionX,
                                positionY: this.player.positionY
                            })
                        }
                    }
                }
            }
        }
        return {
            isSuccess: false,
            error: 'Niedozwolona operacja'
        }
    }

    getField({ positionX, positionY }) {
        for (let i = 0; i < this.fields.length; i++) {
            if (positionX == this.fields[i].positionX && positionY == this.fields[i].positionY) {
                return this.fields[i]
            }
        }
        return;
    }

    operation(command) {
        command = command.toLowerCase()
        let res = undefined
        if (command == "west" || command == "w") {
            res = this.move({ where: "W" })
        } else if (command == "east" || command == "e") {
            res = this.move({ where: "E" })
        } else if (command == "south" || command == "s") {
            res = this.move({ where: "S" })
        } else if (command == "north" || command == "n") {
            res = this.move({ where: "N" })
        }

        if (!res) {
            return {
                isSuccess: false,
                error: 'Nie ma takiej komendy',
                player: this.player
            }
        }
        if (!res.isSuccess) {
            return {
                isSuccess: false,
                error: 'Niedozwolona operacja',
                player: this.player
            }
        }

        return {
            isSuccess: true,
            data: res,
            player: this.player
        }
    }

}

let game = new Game()
render(game.startGame().current)

document.addEventListener("keydown", (e) => {
    let panel = document.querySelector('.panel')
    if (e.code == "Enter") {
        let result = game.operation(document.querySelector('input').value)
        if (!result.isSuccess) {
            renderError(result.error)
        } else {
            while (panel.firstChild) {
                panel.removeChild(panel.firstChild)
            }
            render(result.data.current)
            let h3_4 = document.createElement('h3')
            h3_4.innerText = result.player.getItem()
            panel.appendChild(h3_4)
            console.log(result)
        }


    }
})

function render(current) {
    let panel = document.querySelector('.panel')
    let h3_1 = document.createElement('h3'),
        divek = document.createElement('div'),
        cover = document.createElement('div'),
        h3_2 = document.createElement('h3'),
        h3_3 = document.createElement('h3')
    h3_1.innerText = current.text
    console.log(current)
    panel.appendChild(h3_1)
    divek.classList.add('image')
    cover.classList.add('image-cover')
    divek.style.backgroundImage = `url('./img/${current.imagePath}')`
    let color = current.color.slice(4, -2).split(",")
    let newColor = "rgba("
    for (let o = 0; o < color.length; o++) {
        newColor += color[o] + ","
    }
    newColor += "0.4)"
    console.log(newColor)
    cover.style.background = newColor
    divek.appendChild(cover)
    panel.appendChild(divek)
    h3_2.innerText = "You can go "
    for (let direction of current.directions) {
        h3_2.innerText += direction + ", "
    }
    panel.appendChild(h3_2)
    if (!current.item) {
        h3_3.innerText = "You see nothing"
    } else {
        h3_3.innerText = "You see " + current.item
    }
    panel.appendChild(h3_3)
    document.querySelector('.input__panel h3').innerHTML = 'What now?'
}


function renderError(error) {
    document.querySelector('.input__panel h3').innerHTML = error
}